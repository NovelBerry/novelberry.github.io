<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REINO CHAMPI√ë√ìN: Batalla de Compa√±eros</title>
    <style>
        /* Estilo de Consola Retro */
        body {
            background-color: #2c3e50; /* Azul Oscuro (Color Game Boy) */
            color: #ecf0f1; /* Gris Claro */
            font-family: 'Courier New', monospace; /* Alternativa simple */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            text-align: center;
        }

        .game-container {
            padding: 20px;
            border: 6px solid #f1c40f; /* Borde Amarillo "Poder" */
            border-radius: 10px;
            background-color: #34495e; /* Azul/Gris Interior */
            max-width: 700px;
            min-height: 550px;
            position: relative;
            box-shadow: 0 0 0 10px #2c3e50;
        }

        h1 {
            color: #1abc9c; /* Verde Menta */
            font-size: 1.5em;
            margin-bottom: 15px;
            text-shadow: 2px 2px #000000;
        }

        /* DISPLAY DE ESTADO */
        #status-display {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #7f8c8d;
            border-radius: 5px;
            font-size: 0.9em;
            text-align: left;
            background-color: #2c3e50;
        }
        .stat-pe { color: #f39c12; }
        .stat-team { color: #3498db; }
        .stat-items { color: #9b59b6; } 

        /* PANTALLA DE BATALLA/HISTORIA */
        #story-text {
            font-size: 1em;
            line-height: 1.5;
            margin-bottom: 20px;
            white-space: pre-wrap;
            text-align: left;
            min-height: 150px;
            padding: 10px;
            border: 2px solid #e74c3c; /* Rojo Peligro */
            background-color: #252d37;
        }
        
        /* VISUAL DE BATALLA */
        .battle-screen {
            border: 3px solid #f39c12;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #1d2630;
            text-align: center;
        }
        .battle-foe { color: #e74c3c; font-size: 1.5em; }
        .battle-ally { color: #2ecc71; font-size: 1.5em; }
        #battle-log {
            font-size: 1em;
            margin-top: 15px;
            min-height: 40px;
            color: #e0e0e0;
        }

        /* BOTONES DE OPCI√ìN */
        #choice-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .choice-button {
            background-color: #27ae60; 
            color: #ffffff;
            border: 2px solid #2ecc71;
            padding: 10px 15px;
            font-size: 0.9em;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.1s;
            text-transform: uppercase;
        }

        .choice-button:hover:not(:disabled) {
            background-color: #2ecc71;
            box-shadow: 0 0 10px #2ecc71;
        }
        
        .choice-button:disabled {
            background-color: #555;
            color: #aaa;
            cursor: not-allowed;
            border-color: #777;
        }
        
        /* Estilos de Batalla Espec√≠ficos */
        .battle-action { background-color: #3498db; }
        .battle-capture { background-color: #9b59b6; }
        .battle-item { background-color: #f1c40f; color: #000; }
        
    </style>
</head>
<body>

<div class="game-container">
    <h1>REINO CHAMPI√ë√ìN: BATALLA DE COMPA√ëEROS</h1>
    <div id="status-display"></div>
    <div id="battle-view" style="display:none;" class="battle-screen">
        <div class="battle-foe">Enemigo: <span id="foe-name"></span> </div>
        <div class="battle-ally">T√∫: <span id="ally-name">MARIO</span> ‚≠ê</div>
        <div id="battle-log"></div>
    </div>
    <div id="story-text"></div>
    <div id="choice-buttons"></div>
</div>

<script>
    // =================================================================================
    // === SISTEMA DE JUEGO MARIO-POK√âMON ===
    // =================================================================================

    let gameStatus = {
        potencia_pe: 100,
        equipo: ["MARIO"],
        items: ["SUPER HONGO", "SUPER HONGO"], 
        currentSceneId: 's1_intro'
    };
    
    let currentFoe = null; 

    // Lista de enemigos/compa√±eros posibles (Actos 1, 2 y 3)
    const COMPANIONS_AND_FOES = {
        'GOOMBA': { power: 15, recruitChance: 60, emoji: 'üçÑ' },
        'KOOPA_TROOPA': { power: 25, recruitChance: 40, emoji: 'üê¢' },
        'LAKITU': { power: 35, recruitChance: 25, emoji: '‚òÅÔ∏è' },
        'PLANTA_PIRA√ëA': { power: 45, recruitChance: 5, emoji: 'ü™¥' },
        'BOWSER_JR': { power: 65, recruitChance: 0, emoji: 'üê¢' }, // Finalista - No reclutable
        'BOO_KING': { power: 70, recruitChance: 0, emoji: 'üëª' },
        'BOWSER': { power: 100, recruitChance: 0, emoji: 'üî•' } // Jefe Final
    };

    // --- FUNCIONES CORE ---

    function updateStatus() {
        const display = document.getElementById('status-display');
        const teamList = gameStatus.equipo.length > 0 ? gameStatus.equipo.join(', ') : 'VAC√çO';
        const itemsList = gameStatus.items.length > 0 ? gameStatus.items.join(', ') : 'NINGUNO';
        
        display.innerHTML = `
            <div class="stat-pe">‚ö° POTENCIA (PE): ${gameStatus.potencia_pe}</div>
            <div class="stat-team">‚≠ê EQUIPO: ${teamList} (${gameStatus.equipo.length}/6)</div>
            <div class="stat-items">üéí OBJETOS: ${itemsList}</div>
        `;
    }

    function applyChanges(changes) {
        if (!changes) return;

        // 1. Manejo de Puntos de Potencia (PE)
        if (changes.pe) {
            gameStatus.potencia_pe += changes.pe;
            gameStatus.potencia_pe = Math.max(0, gameStatus.potencia_pe); 
        }

        // 2. Manejo de Equipo (Reclutar)
        if (changes.reclutar) {
            changes.reclutar.forEach(newMember => {
                if (!gameStatus.equipo.includes(newMember) && gameStatus.equipo.length < 6) {
                    gameStatus.equipo.push(newMember);
                }
            });
        }
        
        // 3. Manejo de Items
        if (changes.item) {
            changes.item.forEach(newItem => {
                gameStatus.items.push(newItem);
            });
        }
        
        updateStatus();
    }

    function checkRequirements(requirements) {
        if (!requirements) return { isMet: true, reason: '' };
        if (requirements.min_pe && gameStatus.potencia_pe < requirements.min_pe) {
            return { isMet: false, reason: `Necesitas ${requirements.min_pe} PE.` };
        }
        if (requirements.requires_member && !gameStatus.equipo.includes(requirements.requires_member)) {
            // Un peque√±o hack: si tiene m√°s de 1 miembro (MARIO + 1), se considera que cumple
            if (requirements.requires_member === "TOAD" && gameStatus.equipo.length > 1) {
                 return { isMet: true, reason: '' };
            }
            return { isMet: false, reason: `Requiere tener a ${requirements.requires_member}.` };
        }
        return { isMet: true, reason: '' };
    }

    // --- FUNCIONES DE BATALLA ---
    
    function startBattle(foeId, nextSuccess, nextFail) {
        const baseFoe = COMPANIONS_AND_FOES[foeId];
        currentFoe = { 
            id: foeId, 
            ...baseFoe, 
            hp: baseFoe.power * 2 
        };
        
        document.getElementById('story-text').style.display = 'none';
        document.getElementById('battle-view').style.display = 'block';
        document.getElementById('foe-name').textContent = `${currentFoe.id} (${currentFoe.hp} HP) ${currentFoe.emoji}`;
        document.getElementById('battle-log').textContent = `¬°Un ${currentFoe.id} salvaje aparece! ¬øQu√© har√° MARIO?`;
        
        renderBattleOptions(nextSuccess, nextFail);
    }
    
    function renderBattleOptions(nextSuccess, nextFail) {
        const buttonsContainer = document.getElementById('choice-buttons');
        buttonsContainer.innerHTML = '';
        
        const attackButton = createButton('ATACAR (Poder Base)', 'battle-action', () => performAttack(nextSuccess, nextFail));
        buttonsContainer.appendChild(attackButton);
        
        const itemButton = createButton('USAR SUPER HONGO', 'battle-item', () => useItem('SUPER HONGO', nextSuccess, nextFail));
        if (!gameStatus.items.includes('SUPER HONGO')) itemButton.disabled = true;
        buttonsContainer.appendChild(itemButton);

        const itemUltraButton = createButton('USAR ULTRA ESTRELLA', 'battle-item', () => useItem('ULTRA ESTRELLA', nextSuccess, nextFail));
        if (!gameStatus.items.includes('ULTRA ESTRELLA')) itemUltraButton.disabled = true;
        buttonsContainer.appendChild(itemUltraButton);
        
        const captureButton = createButton('INTENTAR RECLUTAR', 'battle-capture', () => attemptRecruit(nextSuccess, nextFail));
        if (currentFoe.recruitChance === 0) captureButton.disabled = true; 
        buttonsContainer.appendChild(captureButton);
        
        const runButton = createButton('HUIR (-15 PE)', '', () => endBattle(nextFail, { pe: -15 }));
        buttonsContainer.appendChild(runButton);
    }
    
    function performAttack(nextSuccess, nextFail) {
        const damage = 20 + Math.floor(Math.random() * 10); 
        currentFoe.hp -= damage;
        
        let log = `MARIO ataca con un Super Salto. ¬°${currentFoe.id} recibe ${damage} de da√±o! `;
        
        if (currentFoe.hp <= 0) {
            log += `¬°El ${currentFoe.id} ha sido derrotado!`;
            document.getElementById('battle-log').textContent = log;
            endBattle(nextSuccess, { pe: currentFoe.power * 2 }); 
            return;
        }

        const foeDamage = currentFoe.power;
        gameStatus.potencia_pe -= foeDamage;
        updateStatus();
        
        log += `El ${currentFoe.id} contraataca. Pierdes ${foeDamage} PE. `;
        
        if (gameStatus.potencia_pe <= 0) {
            document.getElementById('battle-log').textContent = log + '¬°MARIO ha sido vencido!';
            renderEnding('E_NO_PE');
            return;
        }
        
        document.getElementById('foe-name').textContent = `${currentFoe.id} (${currentFoe.hp} HP) ${currentFoe.emoji}`;
        document.getElementById('battle-log').textContent = log;
        renderBattleOptions(nextSuccess, nextFail); 
    }
    
    function useItem(item, nextSuccess, nextFail) {
        if (item === 'SUPER HONGO') {
            gameStatus.potencia_pe += 30;
            gameStatus.items.splice(gameStatus.items.indexOf(item), 1); 
            
            document.getElementById('battle-log').textContent = `MARIO usa un ${item}. ¬°Recupera 30 PE!`;
            updateStatus();
            renderBattleOptions(nextSuccess, nextFail);
        } else if (item === 'ULTRA ESTRELLA') {
            gameStatus.items.splice(gameStatus.items.indexOf(item), 1);
            currentFoe.hp -= 50; 
            
            let log = `¬°MARIO usa la ${item}! El ${currentFoe.id} recibe 50 de da√±o! `;
             if (currentFoe.hp <= 0) {
                log += `¬°El ${currentFoe.id} ha sido derrotado!`;
                document.getElementById('battle-log').textContent = log;
                endBattle(nextSuccess, { pe: currentFoe.power * 2 + 50 }); 
                return;
            }
            
            document.getElementById('foe-name').textContent = `${currentFoe.id} (${currentFoe.hp} HP) ${currentFoe.emoji}`;
            document.getElementById('battle-log').textContent = log;
            renderBattleOptions(nextSuccess, nextFail);
        }
    }
    
    function attemptRecruit(nextSuccess, nextFail) {
        const captureChance = currentFoe.recruitChance + (currentFoe.power * 2 - currentFoe.hp); 
        
        if (Math.random() * 100 < captureChance && gameStatus.equipo.length < 6) {
            document.getElementById('battle-log').textContent = `¬°MARIO lanza una Super Bola! ¬°Capturaste a ${currentFoe.id}!`;
            endBattle(nextSuccess, { reclutar: [currentFoe.id], pe: 10 });
        } else {
            document.getElementById('battle-log').textContent = `¬°El ${currentFoe.id} se libera! Pierdes turno y 10 PE.`;
            gameStatus.potencia_pe -= 10;
            updateStatus();
            if (gameStatus.potencia_pe <= 0) {
                renderEnding('E_NO_PE');
                return;
            }
            renderBattleOptions(nextSuccess, nextFail);
        }
    }
    
    function endBattle(nextScene, changes = {}) {
        applyChanges(changes);
        currentFoe = null;
        document.getElementById('battle-view').style.display = 'none';
        document.getElementById('story-text').style.display = 'block';
        
        setTimeout(() => {
            renderScene(nextScene);
        }, 1500);
    }
    
    // --- UTILITIES y RENDERIZADO PRINCIPAL (sin cambios) ---
    function createButton(text, className, onClick) {
        const button = document.createElement('button');
        button.className = 'choice-button ' + className;
        button.textContent = text.toUpperCase();
        button.onclick = onClick;
        return button;
    }
    function disableButtons() {
        document.querySelectorAll('.choice-button').forEach(btn => btn.disabled = true);
    }
    
    function renderScene(sceneId) {
        if (gameStatus.potencia_pe <= 0) {
            renderEnding('E_NO_PE');
            return;
        }
        
        const scene = STORY_TREE[sceneId];
        
        if (!scene) { 
             renderEnding('E_UNDEFINED_NODE'); 
             return; 
        }
        
        gameStatus.currentSceneId = sceneId;
        document.getElementById('story-text').innerHTML = scene.text;
        const buttonsContainer = document.getElementById('choice-buttons');
        buttonsContainer.innerHTML = '';

        if (scene.is_ending) { renderEnding(sceneId); return; }
        
        if (scene.is_battle) {
            startBattle(scene.foe, scene.next_success, scene.next_fail);
            return;
        }
        
        scene.choices.forEach(choice => {
            const button = document.createElement('button');
            button.className = 'choice-button';
            let costText = "";
            let requirementsMet = checkRequirements(choice.requirements);
            
            if (choice.changes && choice.changes.pe) {
                const peChange = choice.changes.pe;
                const sign = peChange >= 0 ? '+' : '';
                costText = ` [${sign}${peChange} PE]`;
            }

            button.textContent = choice.text + costText;
            
            if (!requirementsMet.isMet) {
                button.disabled = true;
                button.textContent = `${choice.text} (REQUERIMIENTO: ${requirementsMet.reason})`;
            }

            button.onclick = () => {
                if (button.disabled) return;
                disableButtons();
                applyChanges(choice.changes);
                renderScene(choice.next);
            };
            buttonsContainer.appendChild(button);
        });
        updateStatus();
    }
    
    // --- FINALES ---
    const ENDINGS = {
        'E_NO_PE': "GAME OVER. ¬°MARIO HA PERDIDO TODA SU ENERG√çA! Tu aventura se detiene aqu√≠. **FIN POR AGOTAMIENTO.**",
        's500_final': ">>> FIN DE DEMOSTRACI√ìN. ¬°GRACIAS POR JUGAR! <<<",
        'E_UNDEFINED_NODE': "!!! ERROR DE SIMULACI√ìN !!! El nudo de la historia no est√° definido. Has llegado al fin de la demo actual. ¬°Reinicia para elegir otro camino!"
    };

    function renderEnding(endingId) {
        document.getElementById('story-text').innerHTML = ENDINGS[endingId] || `FIN DE LA TRAMA. ID: ${endingId}`;
        document.getElementById('story-text').classList.add('ending');
        document.getElementById('story-text').style.display = 'block';
        document.getElementById('battle-view').style.display = 'none';
        document.getElementById('choice-buttons').innerHTML = `<button class="choice-button" onclick="window.location.reload()">REINICIAR AVENTURA</button>`;
        document.getElementById('story-text').style.textAlign = 'center';
    }


    // =================================================================================
    // === √ÅRBOL DE HISTORIA (ACTOS 1, 2 Y 3) ===
    // =================================================================================

    const STORY_TREE = {
        
        // --- ACTO 1 (Pradera y Jungla) ---
        's1_intro': {
            text: "Eres MARIO, el Maestro Entrenador. Llegas a la Pradera Champi√±√≥n en busca de un equipo. Un Goomba salvaje te ha visto.",
            choices: [
                { text: "Enfrentar al Goomba (Iniciar Batalla)", next: 's2_battle_goomba', changes: { pe: -5 } },
                { text: "Escapar a la Casa de Toad", next: 's2_toad_house', changes: { pe: -10 } }
            ]
        },
        's2_battle_goomba': { is_battle: true, foe: 'GOOMBA', next_success: 's3_after_goomba', next_fail: 's1_intro', text: "El GOOMBA te bloquea." },
        's4_battle_koopa': { is_battle: true, foe: 'KOOPA_TROOPA', next_success: 's5_koopa_win', next_fail: 's4_road', text: "¬°El Koopa Troopa te ataca con su caparaz√≥n giratorio!" },
        's9_battle_pira√±a': { is_battle: true, foe: 'PLANTA_PIRA√ëA', next_success: 's10_end_jungle', next_fail: 's6_jungle_entrance', text: "¬°La PLANTA PIRA√ëA es fuerte! ¬°Cuidado con el fuego!" },
        's3_after_goomba': { text: "Tras la batalla, el camino est√° abierto. Ves una extra√±a tuber√≠a brillante que parece un atajo.", choices: [ { text: "Entrar en la Tuber√≠a (Acceso R√°pido)", next: 's4_pipe', changes: { pe: -10 } }, { text: "Continuar por el camino", next: 's4_road', changes: { pe: 5 } } ] },
        's2_toad_house': { text: "La casa de Toad est√° tranquila. Encuentras un kit de primeros auxilios. ¬øRecogerlos o no?", choices: [ { text: "Recoger Super Hongos", next: 's3_after_toad', changes: { item: ["SUPER HONGO"], pe: 5 } }, { text: "Dejar los objetos y salir", next: 's4_road', changes: { pe: -5 } } ] },
        's3_after_toad': { text: "Un Koopa Troopa te ve saliendo de la casa. Te desaf√≠a a una batalla por el territorio.", choices: [ { text: "Aceptar el Desaf√≠o", next: 's4_battle_koopa', changes: { pe: -10 } }, { text: "Intentar razonar con √©l (Requiere TOAD)", next: 's5_reason', changes: { pe: -5 }, requirements: { requires_member: "TOAD" } } ] },
        's5_reason': { text: "¬°Toad interviene! El Koopa, al ver a un compa√±ero, acepta dialogar y te ofrece un Huevo de Yoshi como disculpa.", choices: [ { text: "Aceptar y ECLOSIONAR HUEVO (Reclutar YOSHI)", next: 's7_yoshi_joins', changes: { reclutar: ["YOSHI"], pe: 20 } }, { text: "Rechazar y seguir buscando aventuras", next: 's6_jungle_entrance', changes: { pe: 5 } } ] },
        's5_koopa_win': { text: "Has vencido al Koopa. Obtienes un caparaz√≥n. Encuentras un huevo abandonado.", choices: [ { text: "ECLOSIONAR EL HUEVO (Reclutar a YOSHI)", next: 's7_yoshi_joins', changes: { reclutar: ["YOSHI"], pe: 30 } }, { text: "Vender el caparaz√≥n (+20 PE)", next: 's6_jungle_entrance', changes: { pe: 20 } } ] },
        's7_yoshi_joins': { text: "¬°Yoshi se une! Puedes explorar la peligrosa Jungla de las Sombras.", choices: [ { text: "Ir a la Jungla de las Sombras", next: 's8_jungle_start', changes: { pe: -15 } }, { text: "Volver a la Pradera Champi√±√≥n", next: 's4_road', changes: { pe: 5 } } ] },
        's8_jungle_start': { text: "La jungla es densa y peligrosa. ¬°Una Planta Pira√±a salvaje te ataca!", choices: [ { text: "¬°COMBATE!", next: 's9_battle_pira√±a', changes: { pe: -10 } } ] },
        
        // **NODO DE TRANSICI√ìN AL ACTO 2**
        's10_end_jungle': {
            text: "Has superado la jungla. ¬°El Castillo de Peach se ve! Es hora del Gran Torneo.",
            choices: [
                { text: "Entrar al Castillo y Registrarse (INICIO ACTO 2)", next: 's100_tournament_start', changes: { pe: 10 } }
            ]
        },

        // --- ACTO 2: EL GRAN TORNEO (Rondas Preliminares) ---
        's100_tournament_start': {
            text: "La Princesa Peach te da la bienvenida al Gran Torneo. Hay 3 rondas. Necesitas un equipo fuerte.",
            choices: [
                { 
                    text: "Mostrar tu Equipo (Comenzar Rondas)", 
                    next: 's101_round_1', 
                    requirements: { requires_member: "TOAD" } // Requiere al menos un compa√±ero extra (Mario + 1)
                },
                { text: "Entrenar m√°s antes de empezar", next: 's4_road' } 
            ]
        },
        
        's101_round_1': {
            text: "Ronda 1: ¬°Te enfrentas al Entrenador **LAKITU**!",
            is_battle: true,
            foe: 'LAKITU',
            next_success: 's102_after_round_1',
            next_fail: 's100_tournament_start',
        },
        
        's102_after_round_1': {
            text: "¬°Victoria! El p√∫blico grita tu nombre. Tienes una hora para descansar. ¬øQu√© haces?",
            choices: [
                { text: "Curarte (Recuperas +40 PE)", next: 's105_round_2', changes: { pe: 40 } },
                { text: "Buscar la Tienda Secreta (Requiere KOOPA_TROOPA)", next: 's103_secret_shop', changes: { pe: -10 }, requirements: { requires_member: "KOOPA_TROOPA" } },
                { text: "Contar un chiste p√©simo a Toad (-10 PE por verg√ºenza ajena, ¬°pero fue gracioso!)", next: 's105_round_2', changes: { pe: -10 } } // Acci√≥n humor√≠stica
            ]
        },
        
        's103_secret_shop': {
            text: "Gracias a Koopa, encuentras la tienda. Compras una Ultra Estrella. ¬°Ahora tienes ventaja!",
            choices: [
                { text: "Continuar a la Ronda 2", next: 's105_round_2', changes: { item: ["ULTRA ESTRELLA"] } }
            ]
        },
        
        's105_round_2': {
            text: "Ronda 2: ¬°Un desaf√≠o espectral! ¬°Te enfrentas al temible **REY BOO**!",
            is_battle: true,
            foe: 'BOO_KING',
            next_success: 's106_after_round_2',
            next_fail: 's100_tournament_start',
        },
        
        's106_after_round_2': {
            text: "¬°El Rey Boo cay√≥! Solo queda una batalla: ¬°La final!",
            choices: [
                { text: "Avanzar a la FINAL (INICIO ACTO 3)", next: 's200_final_round', changes: { pe: 50 } }
            ]
        },

        // --- ACTO 3: LA FINAL Y BOWSER (Nodos 200+) ---

        's200_final_round': {
            text: "¬°La arena explota! Te enfrentas a **BOWSER JR.**, el invicto campe√≥n. Te mira con desd√©n desde su Koopa Clown Car.",
            choices: [
                { text: "¬°A LA CARGA! (Comenzar Batalla)", next: 's201_battle_bowser_jr', changes: { pe: -20 } },
                { text: "Distraer a Bowser Jr. con un pl√°tano imaginario (-5 PE de concentraci√≥n)", next: 's200_distraction', changes: { pe: -5 } } // Acci√≥n divertida
            ]
        },
        
        's200_distraction': {
             text: "Intentas distraerlo con m√≠mica de pl√°tano. √âl se confunde. '¬øQu√©? ¬°Aqu√≠ no hay pl√°tanos!', y pierde tiempo.",
             choices: [
                 { text: "¬°Ahora es el momento! ¬°Ataca!", next: 's201_battle_bowser_jr', changes: { pe: -5 } }
             ]
        },

        's201_battle_bowser_jr': {
            is_battle: true,
            foe: 'BOWSER_JR',
            next_success: 's202_tournament_win',
            next_fail: 's100_tournament_start', 
            text: "¬°La batalla final por el Trofeo!"
        },
        
        's202_tournament_win': {
            text: "¬°GANAS! El castillo estalla en v√≠tores. Peach te entrega el Trofeo. Bowser Jr. hace un berrinche y... ¬°la pared se desmorona con un rugido! ",
            choices: [
                { text: "¬°PLOT TWIST! Enfrentar la nueva amenaza", next: 's205_bowser_attack', changes: { pe: 50 } }
            ]
        },

        's205_bowser_attack': {
            text: "¬°Es **BOWSER**! Est√° furioso por la derrota de su hijo. '¬°Este torneo es FALSO!', ruge. '¬°Ahora luchar√°n contra el verdadero campe√≥n!'",
            choices: [
                { text: "Usar el Trofeo como Escudo (Pierdes -25 PE)", next: 's206_battle_bowser', changes: { pe: -25 } },
                { text: "Llamar a todos tus compa√±eros a la vez (Potencia m√°xima)", next: 's206_battle_bowser', changes: { pe: -10 } }
            ]
        },
        
        's206_battle_bowser': {
            is_battle: true,
            foe: 'BOWSER',
            next_success: 's210_game_end',
            next_fail: 'E_NO_PE', 
            text: "¬°LA BATALLA FINAL! Bowser tiene una potencia de 100. ¬°Todo o nada!"
        },
        
        's210_game_end': {
            is_ending: true,
            text: "¬°HAS DERROTADO A BOWSER! La princesa Peach est√° a salvo, el Reino Champi√±√≥n celebra, y tu equipo es reconocido como el m√°s poderoso de la historia. ¬°**FINAL BUENO!**",
            choices: []
        },

        // --- Nodos de Finalizaci√≥n Temporal ---
        's4_pipe': { text: "La tuber√≠a te llev√≥ a un campo de bonificaci√≥n, pero la salida est√° bloqueada. Tienes que retroceder.", choices: [ { text: "Continuar la aventura...", next: 's500_final', changes: { pe: -15 } } ] },
        's4_road': { text: "Sigues el camino, es seguro, pero lento. Pierdes un poco de tiempo.", choices: [ { text: "Continuar la aventura...", next: 's500_final', changes: { pe: -5 } } ] },
        's6_jungle_entrance': { text: "Has llegado a la entrada de la Jungla, pero est√°s cansado. Debes descansar antes de entrar.", choices: [ { text: "Descansar y continuar (FIN DE DEMO)", next: 's500_final', changes: { pe: 5 } } ] }
    };

    // Iniciar el juego
    window.onload = () => {
        updateStatus();
        renderScene(gameStatus.currentSceneId);
    };
</script>
</body>
</html>
