<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üèéÔ∏è Carrera a la Playa</title>
  <style>
    body {
      margin: 0;
      background: #222;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: Arial, sans-serif;
    }
    canvas {
      border: 5px solid #000;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
      display: block;
    }
    #hud {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      background: rgba(0,0,0,0.6);
      padding: 6px 15px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 18px;
    }
    #message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 10px;
      display: none;
      text-align: center;
    }
  </style>
</head>
<body>
  <canvas id="game" width="480" height="640"></canvas>
  <div id="hud">Nivel: <span id="level">1</span> | Km: <span id="km">0</span></div>
  <div id="message">
    <h2 id="msg-title"></h2>
    <button onclick="restartGame()">Reiniciar</button>
  </div>
  <audio id="level-sound" src="https://www.soundjay.com/buttons/sounds/button-10.mp3" preload="auto"></audio>
  <audio id="crash-sound" src="https://www.soundjay.com/transportation/sounds/car-crash-1.mp3" preload="auto"></audio>
  <audio id="powerup-sound" src="https://www.soundjay.com/buttons/sounds/button-3.mp3" preload="auto"></audio>
  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const hudLevel = document.getElementById('level');
    const hudKm = document.getElementById('km');
    const message = document.getElementById('message');
    const levelSound = document.getElementById('level-sound');
    const crashSound = document.getElementById('crash-sound');
    const powerSound = document.getElementById('powerup-sound');

    const lanes = 6;
    const roadWidth = 360;
    const laneWidth = roadWidth / lanes;
    let player = {x: canvas.width/2-20, y: canvas.height-100, width: 40, height: 80, color: 'yellow', immune: false};
    let obstacles = [];
    let objects = [];
    let keys = {};
    let km = 0;
    let level = 1;
    let speed = 3;
    let gameOver = false;
    let immuneTimer = 0;
    let slowTimer = 0;
    let boostTimer = 0;

    function drawRoad(offset){
      ctx.fillStyle = '#555';
      ctx.fillRect(canvas.width/2-roadWidth/2, 0, roadWidth, canvas.height);
      ctx.strokeStyle = 'white';
      ctx.lineWidth = 2;
      ctx.setLineDash([20,20]);
      for(let i=1;i<lanes;i++){
        ctx.beginPath();
        ctx.moveTo(canvas.width/2-roadWidth/2 + i*laneWidth, -canvas.height+offset);
        ctx.lineTo(canvas.width/2-roadWidth/2 + i*laneWidth, canvas.height+offset);
        ctx.stroke();
      }
      ctx.setLineDash([]);
    }

    function drawCar(car){
      ctx.fillStyle = car.color;
      ctx.fillRect(car.x, car.y, car.width, car.height);
    }

    function drawObstacles(){
      obstacles.forEach(o=>{
        ctx.fillStyle = 'red';
        ctx.fillRect(o.x,o.y,o.width,o.height);
      });
    }

    function drawObjects(){
      objects.forEach(obj=>{
        if(obj.type===1) ctx.fillStyle = 'cyan'; // Inmunidad
        if(obj.type===2) ctx.fillStyle = 'blue'; // Lento
        if(obj.type===3) ctx.fillStyle = 'orange'; // Boost
        ctx.beginPath();
        ctx.arc(obj.x+20,obj.y+20,15,0,Math.PI*2);
        ctx.fill();
      });
    }

    function updateObstacles(){
      obstacles.forEach(o=>o.y+=speed);
      obstacles=obstacles.filter(o=>o.y<canvas.height+100);
      if(Math.random()<0.02){
        const lane = Math.floor(Math.random()*lanes);
        obstacles.push({x:canvas.width/2-roadWidth/2+lane*laneWidth+laneWidth/2-20,y:-100,width:40,height:80});
      }
    }

    function updateObjects(){
      objects.forEach(o=>o.y+=speed);
      objects=objects.filter(o=>o.y<canvas.height+50);
      if(Math.random()<0.005){
        const lane=Math.floor(Math.random()*lanes);
        const type=Math.floor(Math.random()*3)+1;
        objects.push({x:canvas.width/2-roadWidth/2+lane*laneWidth+laneWidth/2-20,y:-50,type});
      }
    }

    function checkCollision(){
      for(let o of obstacles){
        if(player.x<o.x+o.width && player.x+player.width>o.x && player.y<o.y+o.height && player.y+player.height>o.y){
          if(!player.immune){
            crashSound.play();
            endGame();
          }
        }
      }
      for(let i=0;i<objects.length;i++){
        let obj=objects[i];
        if(player.x<obj.x+40 && player.x+player.width>obj.x && player.y<obj.y+40 && player.y+player.height>obj.y){
          powerSound.play();
          if(obj.type===1){player.immune=true;immuneTimer=600;}
          if(obj.type===2){slowTimer=600;}
          if(obj.type===3){boostTimer=600;}
          objects.splice(i,1);
          i--;
        }
      }
    }

    function movePlayer(){
      if(keys['ArrowLeft']||keys['a']) player.x-=5;
      if(keys['ArrowRight']||keys['d']) player.x+=5;
      if(keys['ArrowUp']||keys['w']) player.y-=5;
      if(keys['ArrowDown']||keys['s']) player.y+=5;
      if(player.x<canvas.width/2-roadWidth/2) player.x=canvas.width/2-roadWidth/2;
      if(player.x+player.width>canvas.width/2+roadWidth/2) player.x=canvas.width/2+roadWidth/2-player.width;
      if(player.y<0) player.y=0;
      if(player.y+player.height>canvas.height) player.y=canvas.height-player.height;
    }

    let roadOffset=0;
    function updateGame(){
      if(gameOver) return;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      roadOffset=(roadOffset+speed)%40;
      drawRoad(roadOffset);
      drawCar(player);
      drawObstacles();
      drawObjects();
      movePlayer();
      updateObstacles();
      updateObjects();
      checkCollision();

      if(immuneTimer>0){immuneTimer--; if(immuneTimer===0) player.immune=false;}
      if(slowTimer>0) slowTimer--; if(boostTimer>0) boostTimer--;

      let currentSpeed=speed;
      if(slowTimer>0) currentSpeed=speed*0.5;
      if(boostTimer>0) currentSpeed=speed*1.5;

      km+=currentSpeed*0.05;
      hudKm.textContent=Math.floor(km);
      if(Math.floor(km)>=level*100){
        level++;
        speed+=0.3;
        hudLevel.textContent=level;
        levelSound.play();
        if(level>100){
          winGame();
          return;
        }
      }
      requestAnimationFrame(updateGame);
    }

    function endGame(){
      gameOver=true;
      document.getElementById('msg-title').textContent="üí• ¬°Choque!";
      message.style.display='block';
    }

    function winGame(){
      gameOver=true;
      document.getElementById('msg-title').textContent="üèñÔ∏è ¬°Llegaste a la Playa!";
      message.style.display='block';
    }

    function restartGame(){
      player.x=canvas.width/2-20;
      player.y=canvas.height-100;
      obstacles=[];objects=[];km=0;level=1;speed=3;gameOver=false;player.immune=false;
      hudLevel.textContent=1;hudKm.textContent=0;message.style.display='none';
      updateGame();
    }

    document.addEventListener('keydown',e=>keys[e.key]=true);
    document.addEventListener('keyup',e=>keys[e.key]=false);

    updateGame();
  </script>
</body>
</html>
