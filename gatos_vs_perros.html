<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOGS vs CATS: La Guerra del Confort</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #1a1a1a;
            margin: 0;
            flex-direction: column;
            font-family: 'Courier New', monospace;
            color: #ecf0f1;
        }
        canvas {
            border: 8px solid #3498db; /* Azul de estrategia */
            background-color: #f0f0f0; /* Color de piso claro */
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.8);
        }
        .controls {
            margin-top: 20px;
            text-align: center;
        }
        button {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-size: 1em;
        }
        button:hover:not(:disabled) {
            background-color: #27ae60;
        }
        button:disabled {
            background-color: #7f8c8d;
            cursor: not-allowed;
        }
        .stats-panel {
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #7f8c8d;
            width: 800px;
            display: flex;
            justify-content: space-around;
        }
    </style>
</head>
<body>

<div id="stats-panel" class="stats-panel"></div>

<canvas id="gameCanvas" width="800" height="600"></canvas>

<div class="controls">
    <div id="current-action">FASE DE POSICIONAMIENTO. Haz clic en el tablero.</div>
    <button id="btn-next-turn" disabled>Simular Siguiente D√≠a (Turno)</button>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const statsPanel = document.getElementById('stats-panel');
    const btnNextTurn = document.getElementById('btn-next-turn');
    const currentActionDisplay = document.getElementById('current-action');

    // =================================================================
    // CONFIGURACI√ìN DEL JUEGO
    // =================================================================
    const TILE_SIZE = 50;
    const COLS = canvas.width / TILE_SIZE; // 16
    const ROWS = canvas.height / TILE_SIZE; // 12
    
    let gameStatus = {
        comfortPoints: 0,
        energyPoints: 0,
        turn: 1,
        maxTurns: 5,
        budget: 50,
        action: 'PLACE_CAT',
        map: [], // Almacena unidades y recursos
    };

    // Costos de unidades
    const COSTS = {
        CAT: 10,
        SUNBEAM: 5,
        DOG: 10, // Costo simulado para la IA
        BONE: 5, // Costo simulado para la IA
    };

    // =================================================================
    // INICIALIZACI√ìN
    // =================================================================
    function initMap() {
        for (let r = 0; r < ROWS; r++) {
            gameStatus.map[r] = [];
            for (let c = 0; c < COLS; c++) {
                gameStatus.map[r][c] = null; // null = vac√≠o
            }
        }
    }
    initMap();

    // Colocar unidades iniciales de la IA (Perros) y sus recursos
    function placeInitialAI() {
        // Un perro fijo en la esquina y un recurso de ruido
        gameStatus.map[ROWS - 2][COLS - 2] = { type: 'DOG', hp: 30, color: '#f1c40f', effect: 'NOISE' };
        gameStatus.map[ROWS - 2][COLS - 3] = { type: 'BONE', cost: COSTS.BONE, color: '#e67e22', effect: -10 };
    }
    placeInitialAI();
    updateStats();

    // =================================================================
    // FUNCIONES DE DIBUJO
    // =================================================================

    function drawGrid() {
        ctx.strokeStyle = '#bdc3c7'; // L√≠neas grises
        for (let r = 0; r < ROWS; r++) {
            for (let c = 0; c < COLS; c++) {
                ctx.strokeRect(c * TILE_SIZE, r * TILE_SIZE, TILE_SIZE, TILE_SIZE);
            }
        }
    }

    function drawUnits() {
        for (let r = 0; r < ROWS; r++) {
            for (let c = 0; c < COLS; c++) {
                const unit = gameStatus.map[r][c];
                if (unit) {
                    const x = c * TILE_SIZE + TILE_SIZE / 2;
                    const y = r * TILE_SIZE + TILE_SIZE / 2;
                    
                    if (unit.type === 'CAT') {
                        // Gato: C√≠rculo (Confort)
                        ctx.fillStyle = unit.color; // Azul Oscuro
                        ctx.beginPath();
                        ctx.arc(x, y, TILE_SIZE / 3, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.closePath();
                    } else if (unit.type === 'DOG') {
                        // Perro: Cuadrado (Energ√≠a)
                        ctx.fillStyle = unit.color; // Amarillo
                        ctx.fillRect(x - TILE_SIZE / 3, y - TILE_SIZE / 3, TILE_SIZE * 2 / 3, TILE_SIZE * 2 / 3);
                    } else if (unit.type === 'SUNBEAM') {
                        // Rayo de Sol: Cuadrado de Confort
                        ctx.fillStyle = unit.color; // Amarillo Suave
                        ctx.fillRect(c * TILE_SIZE + 5, r * TILE_SIZE + 5, TILE_SIZE - 10, TILE_SIZE - 10);
                        ctx.fillStyle = '#000';
                        ctx.fillText('‚òÄÔ∏è', x - 10, y + 5);
                    } else if (unit.type === 'BONE') {
                        // Hueso Ruidoso: Cuadrado de Ruido
                        ctx.fillStyle = unit.color; // Naranja
                        ctx.fillRect(c * TILE_SIZE + 5, r * TILE_SIZE + 5, TILE_SIZE - 10, TILE_SIZE - 10);
                        ctx.fillStyle = '#000';
                        ctx.fillText('ü¶¥', x - 10, y + 5);
                    }
                }
            }
        }
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawGrid();
        drawUnits();
        
        // Dibujar el estado de los puntos de confort/energ√≠a en el mapa
        ctx.fillStyle = '#333';
        ctx.font = '16px Arial';
        ctx.fillText(`D√çA ${gameStatus.turn}`, 10, 20);
        
        if (gameStatus.turn > gameStatus.maxTurns) {
             ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
             ctx.fillRect(0, 0, canvas.width, canvas.height);
             ctx.fillStyle = 'white';
             ctx.font = '50px Arial';
             ctx.textAlign = 'center';
             ctx.fillText('¬°JUEGO TERMINADO!', canvas.width / 2, canvas.height / 2);
             ctx.font = '30px Arial';
             const result = gameStatus.comfortPoints > gameStatus.energyPoints * 1.5 ? '¬°VICTORIA FELINA!' : '¬°LOS PERROS TE VENCEN!';
             ctx.fillText(result, canvas.width / 2, canvas.height / 2 + 50);
        }
    }

    function updateStats() {
        statsPanel.innerHTML = `
            <div>D√çA: ${gameStatus.turn} / ${gameStatus.maxTurns}</div>
            <div style="color: #3498db;">üíé COMODIDAD (CP): ${gameStatus.comfortPoints}</div>
            <div style="color: #f1c40f;">‚ö° ENERG√çA/RUIDO (EP): ${gameStatus.energyPoints}</div>
            <div style="color: #e74c3c;">üí∞ PRESUPUESTO: ${gameStatus.budget}</div>
        `;
        
        if (gameStatus.budget <= 0 && gameStatus.turn <= gameStatus.maxTurns) {
             btnNextTurn.disabled = false;
        } else {
             btnNextTurn.disabled = true;
        }
    }

    // =================================================================
    // L√ìGICA DEL JUEGO Y TURNO
    // =================================================================

    function handleMapClick(event) {
        if (gameStatus.budget <= 0 || gameStatus.turn > gameStatus.maxTurns) return;

        const rect = canvas.getBoundingClientRect();
        const mouseX = event.clientX - rect.left;
        const mouseY = event.clientY - rect.top;

        const col = Math.floor(mouseX / TILE_SIZE);
        const row = Math.floor(mouseY / TILE_SIZE);

        if (gameStatus.map[row][col] === null) {
            
            let unitType = null;
            let cost = 0;

            if (gameStatus.action === 'PLACE_CAT' && gameStatus.budget >= COSTS.CAT) {
                 unitType = 'CAT';
                 cost = COSTS.CAT;
            } else if (gameStatus.action === 'PLACE_SUNBEAM' && gameStatus.budget >= COSTS.SUNBEAM) {
                 unitType = 'SUNBEAM';
                 cost = COSTS.SUNBEAM;
            }

            if (unitType) {
                gameStatus.map[row][col] = { type: unitType, color: unitType === 'CAT' ? '#3498db' : '#f39c12' };
                gameStatus.budget -= cost;
                
                // Rotar a la siguiente acci√≥n para la compra
                if (gameStatus.action === 'PLACE_CAT') {
                    gameStatus.action = 'PLACE_SUNBEAM';
                    currentActionDisplay.textContent = `Colocando RAYO DE SOL (5¬¢). Clic en el tablero.`;
                } else if (gameStatus.action === 'PLACE_SUNBEAM') {
                    gameStatus.action = 'PLACE_CAT';
                    currentActionDisplay.textContent = `Colocando GATO (10¬¢). Clic en el tablero.`;
                }
            } else {
                 if (cost > gameStatus.budget) {
                     alert("¬°Presupuesto insuficiente!");
                 }
            }
            updateStats();
            draw();
        }
    }

    function simulateDay() {
        if (gameStatus.turn > gameStatus.maxTurns) return;
        
        let dailyComfort = 0;
        let dailyEnergy = 0;

        for (let r = 0; r < ROWS; r++) {
            for (let c = 0; c < COLS; c++) {
                const unit = gameStatus.map[r][c];
                if (unit) {
                    // 1. Ganancia de Comfort por Gatos
                    if (unit.type === 'CAT') {
                        dailyComfort += 10;
                        
                        // 2. Bonificaci√≥n de Confort (Rayo de Sol)
                        if (getNeighborUnit(r, c, 'SUNBEAM')) {
                             dailyComfort += 15; // Bonificaci√≥n de Rayo de Sol
                        }
                    } 
                    
                    // 3. Ganancia de Energ√≠a/Ruido por Perros
                    if (unit.type === 'DOG') {
                        dailyEnergy += 10;
                         // 4. Bonificaci√≥n de Ruido (Hueso)
                         if (getNeighborUnit(r, c, 'BONE')) {
                             dailyEnergy += 15; // Bonificaci√≥n de Hueso
                         }
                    }
                }
            }
        }
        
        // El confort se anula por el ruido
        const netComfort = Math.max(0, dailyComfort - dailyEnergy * 0.5);
        
        gameStatus.comfortPoints += netComfort;
        gameStatus.energyPoints += dailyEnergy;

        // Avanzar Turno
        gameStatus.turn++;
        gameStatus.budget = 50; // Resetear presupuesto
        currentActionDisplay.textContent = `D√çA ${gameStatus.turn} INICIADO. Gasto Total: CP +${netComfort.toFixed(1)}, EP +${dailyEnergy}.`;
        
        // L√≥gica de movimiento simple de la IA (Mover un perro un paso)
        moveAIDog();
        
        if (gameStatus.turn <= gameStatus.maxTurns) {
            btnNextTurn.disabled = true;
            gameStatus.action = 'PLACE_CAT';
        } else {
             btnNextTurn.disabled = true;
        }

        updateStats();
        draw();
    }
    
    function moveAIDog() {
        for (let r = 0; r < ROWS; r++) {
            for (let c = 0; c < COLS; c++) {
                 const unit = gameStatus.map[r][c];
                 if (unit && unit.type === 'DOG') {
                     
                     // IA: Mueve el perro hacia el gato m√°s cercano
                     let targetR = -1, targetC = -1;
                     let minDist = 1000;
                     
                     // Encontrar el gato m√°s cercano
                     for (let gr = 0; gr < ROWS; gr++) {
                         for (let gc = 0; gc < COLS; gc++) {
                              const catUnit = gameStatus.map[gr][gc];
                              if (catUnit && catUnit.type === 'CAT') {
                                   const dist = Math.abs(r - gr) + Math.abs(c - gc); // Distancia Manhattan
                                   if (dist < minDist) {
                                       minDist = dist;
                                       targetR = gr;
                                       targetC = gc;
                                   }
                              }
                         }
                     }
                     
                     // Si encuentra un gato, intenta moverse
                     if (targetR !== -1) {
                         let nextR = r, nextC = c;
                         
                         // Priorizar el eje m√°s lejano
                         if (Math.abs(r - targetR) > Math.abs(c - targetC)) {
                             nextR += (targetR > r) ? 1 : -1;
                         } else if (Math.abs(c - targetC) > 0) {
                             nextC += (targetC > c) ? 1 : -1;
                         }
                         
                         // Si la casilla es vac√≠a, mover el perro
                         if (gameStatus.map[nextR] && gameStatus.map[nextR][nextC] === null) {
                             gameStatus.map[nextR][nextC] = unit;
                             gameStatus.map[r][c] = null;
                             return; // Solo movemos un perro por turno para simplificar
                         }
                     }
                     
                     
                 }
            }
        }
    }


    function getNeighborUnit(r, c, targetType) {
        // Simple verificaci√≥n en 3x3 alrededor
        for (let i = -1; i <= 1; i++) {
            for (let j = -1; j <= 1; j++) {
                if (i === 0 && j === 0) continue;
                
                const nr = r + i;
                const nc = c + j;
                
                if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS) {
                    const neighbor = gameStatus.map[nr][nc];
                    if (neighbor && neighbor.type === targetType) {
                        return neighbor;
                    }
                }
            }
        }
        return null;
    }


    // =================================================================
    // EVENT LISTENERS E INICIO
    // =================================================================
    
    canvas.addEventListener('click', handleMapClick);
    btnNextTurn.addEventListener('click', simulateDay);

    // Bucle principal del juego
    function gameLoop() {
        draw();
        requestAnimationFrame(gameLoop);
    }
    gameLoop();
</script>

</body>
</html>
